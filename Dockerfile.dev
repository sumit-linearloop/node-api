FROM node:18 
WORKDIR /app 
COPY package*.json ./ 
RUN npm install
RUN apt-get update && \
    apt-get install -y awscli jq && \
    apt-get clean
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_REGION
RUN aws secretsmanager get-secret-value --secret-id sumit-DevOps --region ap-south-1 | \
    jq -r '.SecretString | fromjson | to_entries | .[] | "\(.key)=\(.value)"' > .env && \
    cat .env
COPY . .
EXPOSE 1400
CMD ["sh", "-c", "node -r dotenv/config index.js dotenv_config_path=.env"]